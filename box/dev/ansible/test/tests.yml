# NB: playbook requires vars [admin_token, producer_token, consumer_token]
#######################
### TESTS policies
#######################
### ACL

- name: Debug tokens
  debug:
    msg: "admin_token {{ admin_token }}\nproducer_token {{producer_token}}\nconsumer_token {{consumer_token}}"

- name: List acl - admin token - allow
  shell: consul acl token list
  environment:
    CONSUL_HTTP_TOKEN: "{{ admin_token }}"

- name: List acl - producer token - deny
  shell: consul acl token list
  register: consul_acl_list_try1
  environment:
    CONSUL_HTTP_TOKEN: "{{ producer_token }}"
  failed_when: consul_acl_list_try1.rc == 0

- name: List acl - consumer token - deny
  shell: consul acl token list
  register: consul_acl_list_try2
  environment:
    CONSUL_HTTP_TOKEN: "{{ consumer_token }}"
  failed_when: consul_acl_list_try2.rc == 0

### K/V todo

### Intentions todo
